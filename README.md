# tinywasm/dom
<!-- START_SECTION:BADGES_SECTION -->
<a href="docs/img/badges.svg"><img src="docs/img/badges.svg" alt="Project Badges" title="Generated by devflow from github.com/tinywasm/devflow"></a>
<!-- END_SECTION:BADGES_SECTION -->

> **Ultra-minimal DOM & event toolkit for Go (TinyGo WASM-optimized).**

tinywasm/dom provides a minimalist, WASM-optimized way to interact with the browser DOM in Go, avoiding the overhead of the standard library and `syscall/js` exposure. It is designed specifically for **TinyGo** applications where binary size and performance are critical.

## ðŸš€ Features

*   **TinyGo Optimized**: Avoids heavy standard library packages like `fmt` or `net/http` to keep WASM binaries small.
*   **Direct DOM Manipulation**: No Virtual DOM overhead. You control the updates.
*   **ID-Based Caching**: Efficient element lookup and caching strategy.
*   **Memory Safe**: Automatic event listener cleanup on `Unmount`.

## ðŸ“¦ Installation

```bash
go get github.com/tinywasm/dom
```

## âš¡ Quick Start

### 1. Global API vs Instance
`tinywasm/dom` provides two ways to interact with the DOM:
When you call `dom.Mount(parent, myList)`, the library will:
- **Instance API**: If you need multiple isolated DOM instances (e.g., for testing or multiple root contexts).

### 2. Go Component
Here is a simple "Counter" component example.

```go
//go:build wasm

package main

import (
	"github.com/tinywasm/dom"
	. "github.com/tinywasm/dom/html" // DSL for UI
	"github.com/tinywasm/fmt"
)

type Counter struct {
	dom.BaseComponent // Optional: Provides ID() and SetID()
	count int
}

func NewCounter() *Counter {
	return &Counter{}
}

// ID() is provided by dom.BaseComponent

func (c *Counter) Render() dom.Node {
	return Div(
		ID(c.ID()),
		Span(ID(c.ID()+"-val"), Text(fmt.Sprint(c.count))),
		Button(Text("Increment"), OnClick(func(e dom.Event) {
			c.count++
			dom.Update(c)
		})),
	)
}

func main() {
	dom.Render("app", NewCounter()) // Auto-generates ID if empty
	select {}
}
```

> [!TIP]
> **Why the dot-import (`.`)?**
> We recommend dot-importing `github.com/tinywasm/dom/html` to create a clean DSL for your UI. This allows you to write `Div(...)` instead of `html.Div(...)`.
> Because the builder functions are in their own subpackage, this is safe and doesn't collide with the core `dom` runtime functions like `Render` or `Update`.

### 2. Manual Control (Legacy)
If you prefer strings or need complex manual control:

```go
func (c *Counter) RenderHTML() string {
	return Html("<div id='", c.ID(), "'>...</div>").String()
}

func (c *Counter) OnMount() {
	btn, _ := dom.Get(c.ID() + "-btn")
	btn.Click(func(e dom.Event) {
		c.count++
		dom.Update(c) // Still works!
	})
}
```

### 3. Nested Components
`tinywasm/dom` supports recursive mounting and unmounting. To use this, implement the `Children()` method (or embed `BaseComponent` for the default `nil`).

```go
type MyList struct {
    dom.BaseComponent
    items []dom.Component
}

func (c *MyList) Children() []dom.Component {
    return c.items
}

func (c *MyList) RenderHTML() string {
    var html string
    for _, item := range c.items {
        html += item.RenderHTML()
    }
    return Html("<div id='", c.ID(), "'>", html, "</div>").String()
}
```

When you call `dom.Render(parent, myList)`, the library will:
1. Inject the HTML.
2. Call `OnMount` for `MyList`.
3. Recursively call `OnMount` for all `items`.

The same recursion applies to `Unmount`, ensuring all event listeners are cleaned up.

## ðŸŽ¯ Event Delegation
```go
func (c *MyList) OnMount() {
    root, _ := dom.Get(c.ID())
    
    // Catch clicks from any child button using TargetID
    root.On("click", func(e dom.Event) {
        id := e.TargetID() // "list-item-1", "list-item-2", etc.
        // Handle logic...
    })
}
```

## ðŸ“š Documentation

For more detailed information, please refer to the documentation in the `docs/` directory:

1.  **[Specification & Philosophy](docs/SPECIFICATION.md)**: Design goals, architecture, and key decisions.
2.  **[API Reference](docs/API.md)**: Detailed definition of `DOM`, `Element`, and `Component` interfaces.
3.  **[Creating Components](docs/COMPONENTS.md)**: Guide to building basic and nested components.
4.  **[Event Handling](docs/EVENTS.md)**: Using the `Event` interface for clicks, inputs, and forms.
5.  **[tinywasm/fmt Helper](docs/TINYWASM.FMT.md)**: Quick guide for string conversions and manipulations.
6.  **[Advanced Patterns](docs/ADVANCED.md)**: Dynamic lists, decoupling, and performance tips.
7.  **[Comparison](docs/COMPARISON.md)**: TinyDOM vs. syscall/js, VDOM, and JS frameworks.


## License

MIT